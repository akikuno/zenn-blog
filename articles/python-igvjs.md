---
title: "Python+IGV.jsでローカルのBAMファイルを可視化する"
emoji: "✨"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["バイオインフォマティクス", "Python", "IGV"]
published: false
---

# まとめ
- ローカルホストを使うとIGV.jsでお手持ちのファイルを可視化できます
- Pythonを使うとHTMLの生成とローカルサーバーを立ち上げを一括して行えるのでとても便利です

# はじめに

最近はBAMファイルをIGVで可視化するお仕事をしています。

IGVはとても便利ですが、以下のような時にちょっとした面倒臭さを感じていました。
  - 標準ゲノム以外の配列で可視化したいときに、いちいちGUIで「Genomes」→「Load Genome from File...」をクリックする必要がある
  - 複数のサンプルをドラッグ＆ドロップすると順番がばらばらになる
  - 起動にすこし時間がかかる

いろいろ調べていたところ、IGVのブラウザ版であるIGV.jsがありました。
  - 簡単なHTMLを作れば可視化できる！
  - カスタムゲノムも表示する順番もHTMLに埋め込めばいいので間違えない！

ということでテンションが上りました

# IGV.jsの使い方

（IGV.jsのHTMLスクリプト）

# ローカルファイルの表示ができない…？

- なにも考えずにローカルのファイルパスを指定したところ、`Error`となりました…

(Errorの写真)

- [ブラウザのセキュリティ規則によって、ローカルファイルの表示はできない](https://github.com/igvteam/igv.js/issues/311)ようです。
- ユーザーがドロップ＆ドラックをすれば良いとのことですが、それだと自動化できないのですよね…

# NodeJSならなんとかなるのかも？

まったく無知ではあるものの「nodejsとやらを使えばローカルファイルへアクセスができる」といったにわか知識があったので、nodejs関連で調べることにしました。

するとローカルホストでhtmlファイルを開くことができる[http-server](https://www.npmjs.com/package/http-server)があったので、試してみました。

```bash:npx-http-server.sh
npx http-server -a localhost -p 8000 -o igvjs.html
```

（IGV.jsの図）

おおお！可視化できた！試合終了！！

と思ったのですが、NodeJS自体に無知なのと、インストールにかなり手間取ったので、使いたくありませんでした。
- `apt`で入るNodeJSのバージョンが古すぎてまったく使い物にならなず、かつ新しくインストールしたバージョンと衝突してしまったのが原因です🤬

# それってPythonでできるのでは？

なにもわからないながら調べていると、どうやらローカルホスト内ではローカルファイルにアクセスできるようなので、とにかくローカルホストを立ち上げさえすれば良いらしいことが分かってきました。

ローカルホストを立ち上げるだけ？なら、Pythonの[http.server](https://docs.python.org/ja/3/library/http.server.html)モジュールでできそうです。

# Pythonでやってみた


# PythonでHTMLの埋め込みをして、複数のBAMファイルを表示させてみた

# Pythonでブラウザを起動させてみた

# おわりに

Pythonには[バッテリー同梱](https://docs.python.org/ja/3/tutorial/stdlib.html#batteries-included)という哲学があることは知っていましたが、今回その強みを実感しました。

外部モジュールを必要とせずにローカルホストの立ち上げやブラウザの起動ができるのはとても便利で、感動しました。


